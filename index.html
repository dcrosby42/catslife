<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Phaser - Making your first game, part 1</title>
	<script type="text/javascript" src="phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

  <a href="/phaser/examples/assets/sky.png">Sky</a>
<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.CANVAS, '', { preload: preload, create: create, update: update });

function preload() {

    game.load.image('phaser', '/phaser/examples/assets/sprites/phaser-dude.png');
    game.load.tilemap('desert', '/phaser/examples/assets/maps/burd.json', null, Phaser.Tilemap.TILED_JSON);
    game.load.tileset('tiles', '/phaser/examples/assets/maps/ground_1x1.png', 32, 32);
    game.load.spritesheet('trees', '/phaser/examples/assets/maps/walls_1x2.png', 32, 64);

    //game.load.spritesheet('cat', '/phaser/examples/assets/maps/walls_1x2.png', 32, 64);

    game.load.spritesheet('cat', 'assets/cat_frames.png', 150,150);
}

var map;
var tileset;
var layer;

var sprite;
var group;
var oldY = 0;
var cursors;

var myText;

function create() {

    //  Create our tilemap to walk around
    map = game.add.tilemap('desert');
    tileset = game.add.tileset('tiles');
    layer = game.add.tilemapLayer(0, 0, 800, 600, tileset, map, 0);

    //  This group will hold the main player + all the tree sprites to depth sort against
    group = game.add.group();

    //  The player
    // sprite = group.create(300, 200, 'phaser');
    var fr=7;
    sprite = group.create(300, 200, 'cat');
    sprite.animations.add('stand_down', [0], fr, true);
    sprite.animations.add('walk_down', [1,2], fr, true);
    sprite.animations.add('stand_up', [3], fr, true);
    sprite.animations.add('walk_up', [4,5], fr, true);
    sprite.animations.add('stand_right', [6], fr, true);
    sprite.animations.add('walk_right', [7,8], fr, true);
    sprite.animations.add('stand_left', [9], fr, true);
    sprite.animations.add('walk_left', [10,11], fr, true);
    sprite.animations.play('stand_up');
    sprite.scale.x = 0.5;
    sprite.scale.y = 0.5;

    myText = game.add.text(16,16, 'uhhh', {font: '16px arial', fill: "#000" });
    myText.visible = false;

    //  Some trees
    for (var i = 0; i < 50; i++)
    {
        var x = game.math.snapTo(game.world.randomX, 32);
        var y = game.math.snapTo(game.world.randomY, 32);
        group.create(x, y, 'trees', game.rnd.integerInRange(0, 8));
    }

    //  Move it
    cursors = game.input.keyboard.createCursorKeys();

}

var dir = 'down';
function update() {

    sprite.body.velocity.x = 0;
    sprite.body.velocity.y = 0;

    var move = 'idle';
    if (cursors.up.isDown)
    {
        sprite.body.velocity.y = -200;
        // sprite.animations.play('walk_up');
        move = 'up';
    }
    else if (cursors.down.isDown)
    {
        sprite.body.velocity.y = 200;
        move = 'down';
    }

    if (cursors.left.isDown)
    {
        sprite.body.velocity.x = -200;
        move = 'left';
    }
    else if (cursors.right.isDown)
    {
        sprite.body.velocity.x = 200;
        move = 'right';
    }

    if (move === 'idle') {
      sprite.animations.play("stand_"+dir);

    } else {
      dir = move;
      sprite.animations.play('walk_'+dir);
    }

    myText.content = "dir="+dir+", move="+move;

    
    if (sprite.y !== oldY)
    {
        //  Group.sort() is an expensive operation
        //  You really want to minimise how often it is called as much as possible.
        //  So this little check helps at least, but if you can do it even less than this.
        group.sort();
        oldY = sprite.y;
    }

}
</script>

</body>
</html>
